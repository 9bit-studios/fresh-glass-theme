{%- comment -%}
  Petersen Games - Blog Content Slideshow Section
  Advanced slideshow for blog posts with storytelling support
  Features image galleries, video embeds, and narrative transitions
{%- endcomment -%}

<div class="petersen-blog-slideshow" id="section-{{ section.id }}">
  <div class="slideshow-container">
    {%- if section.settings.show_title -%}
      <div class="slideshow-header">
        <h2 class="slideshow-title">{{ section.settings.title | default: 'Visual Story' }}</h2>
        {%- if section.settings.subtitle != blank -%}
          <p class="slideshow-subtitle">{{ section.settings.subtitle }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="slideshow-wrapper">
      {%- comment -%} Slide Controls {%- endcomment -%}
      <div class="slide-controls">
        <button class="slide-nav prev" aria-label="Previous slide">
          <img src="https://cdn.shopify.com/s/files/1/0701/0277/8037/files/1-01.svg?v=1757991638" alt="" class="nav-icon">
        </button>

        <div class="slide-indicators">
          {%- for block in section.blocks -%}
            <button
              class="slide-indicator {% if forloop.first %}active{% endif %}"
              data-slide="{{ forloop.index0 }}"
              aria-label="Go to slide {{ forloop.index }}">
              <span class="indicator-dot"></span>
            </button>
          {%- endfor -%}
        </div>

        <button class="slide-nav next" aria-label="Next slide">
          <img src="https://cdn.shopify.com/s/files/1/0701/0277/8037/files/1-01.svg?v=1757991638" alt="" class="nav-icon next-icon">
        </button>
      </div>

      {%- comment -%} Slides Container {%- endcomment -%}
      <div class="slides-container">
        <div class="slides-track" style="transform: translateX(0%)">
          {%- for block in section.blocks -%}
            {%- case block.type -%}

              {%- when 'image_slide' -%}
                <div class="slide image-slide {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.index0 }}">
                  <div class="slide-media">
                    {%- if block.settings.image != blank -%}
                      <img
                        src="{{ block.settings.image | img_url: '1200x800' }}"
                        alt="{{ block.settings.image.alt | default: block.settings.slide_title }}"
                        class="slide-image"
                        loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                      >
                    {%- else -%}
                      <div class="slide-placeholder">
                        <span class="placeholder-icon">üñºÔ∏è</span>
                        <span class="placeholder-text">Image Slide</span>
                      </div>
                    {%- endif -%}

                    {%- if block.settings.show_overlay -%}
                      <div class="slide-overlay"></div>
                    {%- endif -%}
                  </div>

                  {%- if block.settings.slide_title != blank or block.settings.slide_content != blank -%}
                    <div class="slide-content">
                      {%- if block.settings.slide_title != blank -%}
                        <h3 class="slide-title">{{ block.settings.slide_title }}</h3>
                      {%- endif -%}
                      {%- if block.settings.slide_content != blank -%}
                        <div class="slide-text">{{ block.settings.slide_content }}</div>
                      {%- endif -%}
                      {%- if block.settings.slide_link_url != blank -%}
                        <a href="{{ block.settings.slide_link_url }}" class="slide-link">
                          {{ block.settings.slide_link_text | default: 'Learn More' }}
                          <img src="https://cdn.shopify.com/s/files/1/0701/0277/8037/files/1-07.svg?v=1757991638" alt="" class="link-icon">
                        </a>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                </div>

              {%- when 'video_slide' -%}
                <div class="slide video-slide {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.index0 }}">
                  <div class="slide-media">
                    {%- if block.settings.video_url != blank -%}
                      <div class="video-embed">
                        <iframe
                          src="{{ block.settings.video_url }}"
                          title="{{ block.settings.slide_title | default: 'Video Content' }}"
                          frameborder="0"
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                          allowfullscreen
                          loading="lazy">
                        </iframe>
                      </div>
                    {%- else -%}
                      <div class="slide-placeholder">
                        <span class="placeholder-icon">üé•</span>
                        <span class="placeholder-text">Video Slide</span>
                      </div>
                    {%- endif -%}
                  </div>

                  {%- if block.settings.slide_title != blank or block.settings.slide_content != blank -%}
                    <div class="slide-content video-content">
                      {%- if block.settings.slide_title != blank -%}
                        <h3 class="slide-title">{{ block.settings.slide_title }}</h3>
                      {%- endif -%}
                      {%- if block.settings.slide_content != blank -%}
                        <div class="slide-text">{{ block.settings.slide_content }}</div>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                </div>

              {%- when 'narrative_slide' -%}
                <div class="slide narrative-slide {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.index0 }}">
                  <div class="narrative-content">
                    {%- if block.settings.narrative_icon != blank -%}
                      <div class="narrative-icon">
                        <img src="{{ block.settings.narrative_icon }}" alt="" class="story-icon">
                      </div>
                    {%- endif -%}

                    {%- if block.settings.slide_title != blank -%}
                      <h3 class="slide-title narrative-title">{{ block.settings.slide_title }}</h3>
                    {%- endif -%}

                    {%- if block.settings.slide_content != blank -%}
                      <div class="slide-text narrative-text">{{ block.settings.slide_content }}</div>
                    {%- endif -%}

                    {%- if block.settings.highlight_quote != blank -%}
                      <blockquote class="narrative-quote">
                        "{{ block.settings.highlight_quote }}"
                      </blockquote>
                    {%- endif -%}
                  </div>

                  <div class="narrative-background">
                    {%- if block.settings.background_image != blank -%}
                      <img
                        src="{{ block.settings.background_image | img_url: '1200x800' }}"
                        alt=""
                        class="background-image"
                        loading="lazy"
                      >
                    {%- endif -%}
                    <div class="narrative-overlay"></div>
                  </div>
                </div>

            {%- endcase -%}
          {%- endfor -%}
        </div>
      </div>

      {%- comment -%} Slide Progress Bar {%- endcomment -%}
      <div class="slide-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: {% if section.blocks.size > 0 %}{{ 100.0 | divided_by: section.blocks.size }}{% else %}0{% endif %}%"></div>
        </div>
        <span class="slide-counter">
          <span class="current-slide">1</span> / <span class="total-slides">{{ section.blocks.size }}</span>
        </span>
      </div>
    </div>
  </div>
</div>

<style>
.petersen-blog-slideshow {
  margin: {{ section.settings.margin_top }}px 0 {{ section.settings.margin_bottom }}px 0;
  background: transparent;
}

.slideshow-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Header */
.slideshow-header {
  text-align: center;
  margin-bottom: 40px;
}

.slideshow-title {
  font-size: 2rem;
  font-weight: 700;
  color: white;
  margin: 0 0 16px 0;
  letter-spacing: -0.02em;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 2px 12px rgba(0, 0, 0, 0.7), 0 0 25px rgba(255, 255, 255, 0.12);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.slideshow-subtitle {
  font-size: 18px;
  color: rgba(255, 255, 255, 0.9);
  margin: 0;
  line-height: 1.5;
  text-shadow: 0 1px 6px rgba(0, 0, 0, 0.4), 0 0 15px rgba(255, 255, 255, 0.08);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Slideshow Wrapper */
.slideshow-wrapper {
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  overflow: hidden;
  position: relative;
}

/* Slide Controls */
.slide-controls {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 24px;
  z-index: 10;
  pointer-events: none;
}

.slide-nav {
  width: 48px;
  height: 48px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  pointer-events: auto;
}

.slide-nav:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

.nav-icon {
  width: 20px;
  height: 20px;
  filter: invert(1);
  transition: transform 0.2s ease;
}

.next-icon {
  transform: rotate(180deg);
}

.slide-indicators {
  display: flex;
  gap: 12px;
  pointer-events: auto;
}

.slide-indicator {
  width: 12px;
  height: 12px;
  border: none;
  background: transparent;
  cursor: pointer;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.indicator-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.4);
  transition: all 0.3s ease;
}

.slide-indicator.active .indicator-dot {
  background: #667eea;
  transform: scale(1.5);
  box-shadow: 0 0 12px rgba(102, 126, 234, 0.5);
}

/* Slides */
.slides-container {
  position: relative;
  overflow: hidden;
  height: 600px;
}

.slides-track {
  display: flex;
  height: 100%;
  transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.slide {
  flex: 0 0 100%;
  position: relative;
  display: flex;
  align-items: center;
  opacity: 0;
  transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.slide.active {
  opacity: 1;
}

/* Image Slides */
.image-slide {
  background: rgba(0, 0, 0, 0.2);
}

.slide-media {
  position: relative;
  flex: 1;
  height: 100%;
  overflow: hidden;
}

.slide-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.8s ease-out;
}

.slide:hover .slide-image {
  transform: scale(1.05);
}

.slide-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.6) 100%);
  pointer-events: none;
}

.slide-content {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(transparent, rgba(0,0,0,0.8));
  padding: 60px 40px 40px 40px;
  color: white;
}

.slide-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: white;
  margin: 0 0 16px 0;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6), 0 0 20px rgba(255, 255, 255, 0.1);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.slide-text {
  font-size: 16px;
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.6;
  margin: 0 0 24px 0;
  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.4), 0 0 10px rgba(255, 255, 255, 0.06);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.slide-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: #667eea;
  text-decoration: none;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
}

.slide-link:hover {
  color: white;
  transform: translateX(4px);
}

.link-icon {
  width: 16px;
  height: 16px;
  filter: brightness(0) invert(1);
  transition: transform 0.2s ease;
}

.slide-link:hover .link-icon {
  transform: translateX(4px);
}

/* Video Slides */
.video-slide .slide-media {
  background: rgba(0, 0, 0, 0.5);
}

.video-embed {
  position: relative;
  width: 100%;
  height: 100%;
}

.video-embed iframe {
  width: 100%;
  height: 100%;
  border: none;
}

.video-content {
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(20px);
}

/* Narrative Slides */
.narrative-slide {
  position: relative;
  background: rgba(0, 0, 0, 0.6);
  justify-content: center;
  align-items: center;
  text-align: center;
}

.narrative-background {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: -1;
}

.background-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.narrative-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
}

.narrative-content {
  max-width: 600px;
  padding: 40px;
  color: white;
  z-index: 2;
}

.narrative-icon {
  margin-bottom: 24px;
}

.story-icon {
  width: 48px;
  height: 48px;
  filter: invert(1);
  opacity: 0.8;
}

.narrative-title {
  font-size: 2rem;
  margin-bottom: 24px;
}

.narrative-text {
  font-size: 18px;
  margin-bottom: 32px;
}

.narrative-quote {
  font-size: 20px;
  font-style: italic;
  color: #667eea;
  margin: 0;
  padding: 0;
  border: none;
  position: relative;
  text-shadow: 0 1px 6px rgba(0, 0, 0, 0.4);
}

.narrative-quote::before {
  content: '"';
  font-size: 3rem;
  position: absolute;
  top: -20px;
  left: -30px;
  color: rgba(102, 126, 234, 0.3);
}

/* Placeholders */
.slide-placeholder {
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.05);
  border: 2px dashed rgba(255, 255, 255, 0.2);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
}

.placeholder-icon {
  font-size: 48px;
  opacity: 0.3;
}

.placeholder-text {
  font-size: 16px;
  color: rgba(255, 255, 255, 0.5);
}

/* Progress Bar */
.slide-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
  padding: 16px 24px;
  display: flex;
  align-items: center;
  gap: 16px;
}

.progress-bar {
  flex: 1;
  height: 4px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 2px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  border-radius: 2px;
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.slide-counter {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.8);
  font-weight: 500;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.current-slide {
  color: #667eea;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
  .slides-container {
    height: 500px;
  }

  .slide-controls {
    padding: 0 16px;
  }

  .slide-content {
    padding: 40px 24px 24px 24px;
  }

  .slide-title {
    font-size: 1.25rem;
  }

  .narrative-content {
    padding: 24px;
  }

  .narrative-title {
    font-size: 1.5rem;
  }

  .slide-indicators {
    gap: 8px;
  }
}

@media (max-width: 480px) {
  .slides-container {
    height: 400px;
  }

  .slide-nav {
    width: 40px;
    height: 40px;
  }

  .nav-icon {
    width: 16px;
    height: 16px;
  }

  .slideshow-title {
    font-size: 1.5rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const slideshow = document.querySelector('.petersen-blog-slideshow');
  if (!slideshow) return;

  const slidesTrack = slideshow.querySelector('.slides-track');
  const slides = slideshow.querySelectorAll('.slide');
  const indicators = slideshow.querySelectorAll('.slide-indicator');
  const prevButton = slideshow.querySelector('.slide-nav.prev');
  const nextButton = slideshow.querySelector('.slide-nav.next');
  const progressFill = slideshow.querySelector('.progress-fill');
  const currentSlideSpan = slideshow.querySelector('.current-slide');

  let currentSlide = 0;
  const totalSlides = slides.length;

  function updateSlide(index) {
    // Update track position
    const translateX = -index * 100;
    slidesTrack.style.transform = `translateX(${translateX}%)`;

    // Update active states
    slides.forEach((slide, i) => {
      slide.classList.toggle('active', i === index);
    });

    indicators.forEach((indicator, i) => {
      indicator.classList.toggle('active', i === index);
    });

    // Update progress
    const progressWidth = ((index + 1) / totalSlides) * 100;
    progressFill.style.width = `${progressWidth}%`;
    currentSlideSpan.textContent = index + 1;

    currentSlide = index;
  }

  function nextSlide() {
    const next = (currentSlide + 1) % totalSlides;
    updateSlide(next);
  }

  function prevSlide() {
    const prev = (currentSlide - 1 + totalSlides) % totalSlides;
    updateSlide(prev);
  }

  // Event listeners
  if (nextButton) nextButton.addEventListener('click', nextSlide);
  if (prevButton) prevButton.addEventListener('click', prevSlide);

  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', () => updateSlide(index));
  });

  // Keyboard navigation
  slideshow.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') prevSlide();
    if (e.key === 'ArrowRight') nextSlide();
  });

  // Touch/swipe support
  let startX = 0;
  let endX = 0;

  slideshow.addEventListener('touchstart', function(e) {
    startX = e.touches[0].clientX;
  });

  slideshow.addEventListener('touchend', function(e) {
    endX = e.changedTouches[0].clientX;
    const deltaX = startX - endX;

    if (Math.abs(deltaX) > 50) {
      if (deltaX > 0) nextSlide();
      else prevSlide();
    }
  });

  // Auto-advance slides (optional)
  if (totalSlides > 1) {
    let autoPlay = setInterval(nextSlide, 8000);

    slideshow.addEventListener('mouseenter', () => clearInterval(autoPlay));
    slideshow.addEventListener('mouseleave', () => {
      autoPlay = setInterval(nextSlide, 8000);
    });
  }
});
</script>

{% schema %}
{
  "name": "Blog Content Slideshow",
  "tag": "section",
  "class": "petersen-blog-slideshow-section",
  "blocks": [
    {
      "type": "image_slide",
      "name": "Image Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Slide Image"
        },
        {
          "type": "checkbox",
          "id": "show_overlay",
          "label": "Show dark overlay",
          "default": true
        },
        {
          "type": "text",
          "id": "slide_title",
          "label": "Slide Title"
        },
        {
          "type": "richtext",
          "id": "slide_content",
          "label": "Slide Content"
        },
        {
          "type": "url",
          "id": "slide_link_url",
          "label": "Link URL (optional)"
        },
        {
          "type": "text",
          "id": "slide_link_text",
          "label": "Link Text",
          "default": "Learn More"
        }
      ]
    },
    {
      "type": "video_slide",
      "name": "Video Slide",
      "settings": [
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL (YouTube/Vimeo)"
        },
        {
          "type": "text",
          "id": "slide_title",
          "label": "Video Title"
        },
        {
          "type": "richtext",
          "id": "slide_content",
          "label": "Video Description"
        }
      ]
    },
    {
      "type": "narrative_slide",
      "name": "Story/Narrative Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "background_image",
          "label": "Background Image"
        },
        {
          "type": "url",
          "id": "narrative_icon",
          "label": "Story Icon URL",
          "info": "Use a Petersen Games glyph or custom icon"
        },
        {
          "type": "text",
          "id": "slide_title",
          "label": "Story Title"
        },
        {
          "type": "richtext",
          "id": "slide_content",
          "label": "Story Content"
        },
        {
          "type": "textarea",
          "id": "highlight_quote",
          "label": "Featured Quote (optional)"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "Slideshow Header"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show slideshow title",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "Slideshow Title",
      "default": "Visual Story"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Slideshow Subtitle (optional)"
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top margin",
      "default": 60
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom margin",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Blog Content Slideshow",
      "settings": {
        "show_title": true,
        "title": "Visual Story"
      },
      "blocks": [
        {
          "type": "image_slide",
          "settings": {
            "slide_title": "Chapter One",
            "slide_content": "<p>Begin your journey into the cosmic horror universe...</p>",
            "show_overlay": true
          }
        },
        {
          "type": "narrative_slide",
          "settings": {
            "slide_title": "The Story Unfolds",
            "slide_content": "<p>Dive deeper into the narrative that connects all elements of this tale.</p>",
            "highlight_quote": "In the depths of space, horror awaits those who dare to look."
          }
        }
      ]
    }
  ]
}
{% endschema %}