{% comment %}
  Glass Filter Bar
  Pure filtering interface with no navigation links - only filter controls
{% endcomment %}

<div class="glass-filter-bar-container" data-section-id="{{ section.id }}">
  <div class="glass-filter-bar-wrapper">
    
    <!-- Filter Controls -->
    <div class="filter-controls-container">
      
      <!-- Active Filters Display -->
      <div class="active-filters" id="active-filters">
        <div class="active-filter-tags" id="active-filter-tags">
          <!-- Active filter tags will be inserted here dynamically -->
        </div>
        <button class="clear-all-filters" onclick="clearAllFilters()" style="display: none;">
          Clear All
        </button>
      </div>
      
      <!-- Filter Controls -->
      <div class="filter-controls">
        
        <!-- Left Group: Sort and Results -->
        <div class="filter-controls-left">
          <!-- Sort Controls -->
          <div class="filter-control-group">
            <select class="glass-filter-select" onchange="updateSort(this.value)">
              <option value="featured">Featured</option>
              <option value="best-selling">Best Selling</option>
              <option value="title-ascending">A-Z</option>
              <option value="title-descending">Z-A</option>
              <option value="price-ascending">Price: Low to High</option>
              <option value="price-descending">Price: High to Low</option>
              <option value="created-ascending">Oldest First</option>
              <option value="created-descending">Newest First</option>
            </select>
          </div>
          
          <!-- Results Count -->
          <div class="filter-control-group">
            <span class="results-count" id="results-count">
              {{ collections.all.products_count }} products
            </span>
          </div>
        </div>
        
        <!-- Right Group: View Controls -->
        <div class="filter-controls-right">
          <!-- View Controls -->
          <div class="filter-control-group">
            <div class="view-toggle-group">
              <button class="view-toggle active" data-view="grid" onclick="setViewMode('grid')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/>
                </svg>
              </button>
              <button class="view-toggle" data-view="list" onclick="setViewMode('list')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 5h18v2H3V5zm0 6h18v2H3v-2zm0 6h18v2H3v-2z"/>
                </svg>
              </button>
            </div>
          </div>
          
          <!-- Filter Toggle (Mobile) -->
          <div class="filter-control-group mobile-only">
            <button class="mobile-filter-toggle" onclick="toggleMobileFilters()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
              </svg>
              Filters
            </button>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</div>

<style>
/* ========================================
   GLASS FILTER BAR STYLES
   ======================================== */

.glass-filter-bar-container {
  background: linear-gradient(135deg, 
    rgba(76, 29, 149, 0.15) 0%, 
    rgba(99, 102, 241, 0.12) 50%, 
    rgba(139, 92, 246, 0.08) 100%
  );
  backdrop-filter: blur(20px) saturate(120%);
  -webkit-backdrop-filter: blur(20px) saturate(120%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  padding: 12px 0;
  position: sticky;
  top: var(--total-nav-height, 184px);
  z-index: 70; /* Below sliding nav tabs */
}

.glass-filter-bar-wrapper {
  max-width: 1800px; /* Match layout-with-sidebar max-width */
  margin: 0 auto;
  padding: 0 var(--foundation-space-lg, 24px); /* Match layout-with-sidebar padding */
  display: grid;
  grid-template-columns: 320px 1fr; /* Match sidebar layout */
  gap: 0;
}

/* Filter Controls Container */
.filter-controls-container {
  grid-column: 2; /* Place in content column */
  padding-left: 0; /* Removed left padding */
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Active Filters */
.active-filters {
  display: none; /* Hidden by default */
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  min-height: 32px;
}

/* Show when it has filter tags */
.active-filters.has-filters {
  display: flex;
}

.filter-label {
  font-size: 14px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.8);
  white-space: nowrap;
}

.active-filter-tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.filter-tag {
  background: rgba(99, 102, 241, 0.2);
  border: 1px solid rgba(99, 102, 241, 0.3);
  border-radius: 15px;
  padding: 5px 8px 5px 12px; /* Less padding on right for close button */
  font-size: 12px;
  line-height: 1;
  color: white;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  height: 30px;
  transition: all 0.2s ease;
}

.filter-tag:hover {
  background: rgba(99, 102, 241, 0.3);
  transform: translateY(-1px);
}

.filter-tag-remove {
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.8);
  cursor: pointer;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 16px;
  line-height: 1;
  font-weight: 300;
}

.filter-tag-remove:hover {
  background: rgba(255, 255, 255, 0.2);
  color: white;
}

.clear-all-filters {
  background: rgba(255, 59, 48, 0.2);
  border: 1px solid rgba(255, 59, 48, 0.4);
  border-radius: 12px;
  padding: 6px 12px;
  font-size: 12px;
  color: white;
  cursor: pointer;
  transition: all 0.2s ease;
}

.clear-all-filters:hover {
  background: rgba(255, 59, 48, 0.3);
  transform: translateY(-1px);
}

/* Filter Controls */
.filter-controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  gap: 24px;
  padding-bottom: 5px;
}

/* Left and Right Groups */
.filter-controls-left {
  display: flex;
  align-items: center;
  gap: 24px;
  flex-wrap: wrap;
}

.filter-controls-right {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-left: auto; /* Push to right */
}

.filter-control-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-control-label {
  font-size: 13px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.7);
  white-space: nowrap;
}

/* Glass Select */
.glass-filter-select {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  padding: 6px 12px;
  color: white;
  font-size: 13px;
  cursor: pointer;
  min-width: 140px;
  transition: all 0.2s ease;
  outline: none;
}

.glass-filter-select:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(99, 102, 241, 0.4);
}

.glass-filter-select:focus {
  border-color: rgba(99, 102, 241, 0.6);
  box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
}

.glass-filter-select option {
  background: #1a1a1a;
  color: white;
}

/* View Toggle Group */
.view-toggle-group {
  display: flex;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 2px;
  gap: 8px;
  height: 34px; /* 30px buttons + 2px padding top + 2px padding bottom */
}

.view-toggle {
  background: transparent;
  border: none;
  padding: 0 !important;
  width: 36px !important;
  height: 36px !important;
  min-width: 36px !important;
  min-height: 36px !important;
  max-width: 36x !important;
  max-height: 36px !important;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 47.27%, rgba(255, 255, 255, 0.1) 100%);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 4px;
  cursor: pointer;
  transition: var(--foundation-transition, all 0.2s ease);
  color: var(--foundation-foreground-primary, #FCFDF2);  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.view-toggle:hover {
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.8);
}

.view-toggle.active {
  background: rgba(99, 102, 241, 0.2);
  color: white;
}

/* More specific selector to override any global button styles */
.glass-filter-bar-container .view-toggle-group .view-toggle {
  width: 30px !important;
  height: 30px !important;
  min-width: 30px !important;
  min-height: 30px !important;
  max-width: 30px !important;
  max-height: 30px !important;
  line-height: 1 !important;
}

/* Results Count */
.results-count {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
  white-space: nowrap;
}

/* Mobile Filter Toggle */
.mobile-filter-toggle {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  padding: 3px 6px;
  color: rgba(255, 255, 255, 0.8);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.mobile-filter-toggle:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  transform: translateY(-1px);
}

.mobile-only {
  display: none;
}

/* ========================================
   RESPONSIVE DESIGN
   ======================================== */

@media (max-width: 1024px) {
  .glass-filter-bar-wrapper {
    /* On tablet, maintain the grid but adjust spacing */
    grid-template-columns: 280px 1fr; /* Slightly smaller sidebar */
    padding: 0 var(--foundation-space-lg, 24px);
  }
  
  .filter-controls-container {
    padding-left: var(--foundation-space-md, 16px);
  }
  
  .filter-controls {
    gap: 16px;
  }
}

@media (max-width: 1023px) {
  /* Below 1024px, sidebar is hidden so filter bar spans full width */
  .glass-filter-bar-wrapper {
    grid-template-columns: 1fr; /* Single column when sidebar is hidden */
    padding: 0 var(--foundation-space-md, 16px);
  }
  
  .filter-controls-container {
    grid-column: 1; /* Reset to first column */
    padding-left: 0; /* Remove left padding */
  }
}

@media (max-width: 768px) {
  .glass-filter-bar-container {
    padding: 8px 0;
  }
  
  .glass-filter-bar-wrapper {
    padding: 0 var(--foundation-space-md, 16px);
  }
  
  .filter-controls-container {
    gap: 8px;
  }
  
  .filter-controls {
    gap: 12px;
    flex-wrap: wrap;
  }
  
  .filter-controls-left,
  .filter-controls-right {
    gap: 12px;
  }
  
  .mobile-only {
    display: flex;
  }
  
  /* Hide view toggle on mobile, show filter button */
  .view-toggle-group {
    display: none;
  }
  
  .glass-filter-select {
    min-width: 120px;
    font-size: 12px;
  }
  
  .filter-control-label {
    font-size: 12px;
  }
  
  .results-count {
    font-size: 12px;
  }
}

@media (max-width: 767px) {
  .glass-filter-bar-wrapper {
    padding: 0 var(--foundation-space-md, 12px);
  }
}

@media (max-width: 480px) {
  .active-filters {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    min-height: auto;
  }
  
  .filter-controls {
    justify-content: space-between;
    width: 100%;
  }
  
  .filter-controls-left {
    flex: 1;
  }
  
  .filter-controls-right {
    margin-left: 0;
  }
  
  .glass-filter-select {
    min-width: 100px;
  }
}
</style>

<script>
// Filter Bar Functionality
function updateSort(sortValue) {
  console.log('Updating sort to:', sortValue);
  
  // Update URL params
  const url = new URL(window.location);
  url.searchParams.set('sort_by', sortValue);
  
  // Add loading state
  const select = document.querySelector('.glass-filter-select');
  if (select) {
    select.style.opacity = '0.6';
  }
  
  // Navigate to new URL
  window.location.href = url.toString();
}

function setViewMode(viewMode) {
  console.log('Setting view mode to:', viewMode);
  
  // Update active state
  document.querySelectorAll('.view-toggle').forEach(toggle => {
    toggle.classList.remove('active');
  });
  
  document.querySelector(`[data-view="${viewMode}"]`).classList.add('active');
  
  // Store preference
  localStorage.setItem('preferredViewMode', viewMode);
  
  // Apply view mode to product grid
  const productGrid = document.querySelector('.product-grid, .collection-products');
  if (productGrid) {
    productGrid.setAttribute('data-view', viewMode);
  }
  
  // Trigger layout update
  setTimeout(() => {
    window.dispatchEvent(new Event('resize'));
  }, 100);
}

function toggleMobileFilters() {
  console.log('Toggling mobile filters');
  
  // Get or create mobile filter sidebar
  let filterSidebar = document.getElementById('mobile-filter-sidebar');
  
  if (!filterSidebar) {
    // Create mobile filter sidebar if it doesn't exist
    filterSidebar = document.createElement('div');
    filterSidebar.id = 'mobile-filter-sidebar';
    filterSidebar.className = 'mobile-filter-sidebar';
    document.body.appendChild(filterSidebar);
  }
  
  // Toggle visibility
  filterSidebar.classList.toggle('active');
  document.body.classList.toggle('filter-sidebar-open');
}

function clearAllFilters() {
  console.log('Clearing all filters');
  
  // Remove all filter tags
  const filterTags = document.querySelectorAll('.filter-tag');
  filterTags.forEach(tag => tag.remove());
  
  // Hide clear all button
  const clearButton = document.querySelector('.clear-all-filters');
  if (clearButton) {
    clearButton.style.display = 'none';
  }
  
  // Hide active filters section
  const activeFilters = document.getElementById('active-filters');
  if (activeFilters) {
    activeFilters.classList.remove('has-filters');
  }
  
  // Reset URL to base collection URL
  const url = new URL(window.location);
  url.search = '';
  window.location.href = url.toString();
}

function addFilterTag(label, value, removeCallback) {
  const tagsContainer = document.getElementById('active-filter-tags');
  const clearButton = document.querySelector('.clear-all-filters');
  const activeFilters = document.getElementById('active-filters');
  
  if (!tagsContainer) return;
  
  // Create filter tag
  const tag = document.createElement('div');
  tag.className = 'filter-tag';
  tag.innerHTML = `
    ${label}
    <button class="filter-tag-remove" onclick="removeFilterTag(this, '${value}')">Ã—</button>
  `;
  
  tagsContainer.appendChild(tag);
  
  // Show the active filters section
  if (activeFilters) {
    activeFilters.classList.add('has-filters');
  }
  
  // Show clear all button
  if (clearButton) {
    clearButton.style.display = 'block';
  }
}

function removeFilterTag(button, value) {
  const tag = button.closest('.filter-tag');
  const tagsContainer = document.getElementById('active-filter-tags');
  const clearButton = document.querySelector('.clear-all-filters');
  const activeFilters = document.getElementById('active-filters');
  
  if (tag) {
    tag.remove();
  }
  
  // Hide clear all button and active filters section if no tags remain
  if (tagsContainer && tagsContainer.children.length === 0) {
    if (clearButton) {
      clearButton.style.display = 'none';
    }
    if (activeFilters) {
      activeFilters.classList.remove('has-filters');
    }
  }
  
  // Handle filter removal logic here
  console.log('Removing filter:', value);
}

// Initialize filter bar on page load
document.addEventListener('DOMContentLoaded', function() {
  // Restore view mode preference
  const preferredView = localStorage.getItem('preferredViewMode') || 'grid';
  setViewMode(preferredView);
  
  // Update results count if needed
  updateResultsCount();
});

function updateResultsCount(count) {
  const resultsElement = document.getElementById('results-count');
  if (resultsElement && count !== undefined) {
    resultsElement.textContent = `${count} product${count !== 1 ? 's' : ''}`;
  }
}
</script>

{% schema %}
{
  "name": "Glass Filter Bar",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sort",
      "label": "Enable sort controls",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_view_toggle",
      "label": "Enable view toggle",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_results_count",
      "label": "Show results count",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_mobile_toggle",
      "label": "Enable mobile filter toggle",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Glass Filter Bar"
    }
  ]
}
{% endschema %}